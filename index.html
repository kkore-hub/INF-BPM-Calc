<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BPM Calculator Ultimate</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", "Meiryo", "Malgun Gothic", sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            padding: 25px;
            padding-top: 20px;
        }

        /* èªè¨€åˆ— */
        .lang-bar {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .lang-btn {
            padding: 5px 10px;
            font-size: 0.85rem;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 15px;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
        }
        .lang-btn.active {
            background: #2c3e50;
            color: white;
            border-color: #2c3e50;
            font-weight: bold;
        }

        h1 {
            text-align: center;
            font-size: 1.5rem;
            color: #2c3e50;
            margin: 10px 0 20px 0;
        }

        /* --- å…¨åŸŸè¨­å®šå€ (é ‚éƒ¨) --- */
        .global-section {
            background: #fff8e1; /* æ·¡æ·¡çš„é»ƒè‰²èƒŒæ™¯å¼·èª¿ */
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #ffecb3;
            margin-bottom: 25px;
            text-align: center;
        }
        .global-label {
            display: block;
            font-weight: 800;
            color: #d35400;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        .global-input {
            width: 100%;
            max-width: 200px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.5rem;
            text-align: center;
            font-weight: bold;
            color: #2c3e50;
        }
        .global-input:focus {
            border-color: #d35400;
            outline: none;
        }

        /* åˆ†éš”ç·š */
        .divider {
            height: 1px;
            background: #eee;
            margin: 20px 0;
        }

        /* å€å¡Šæ¨™é¡Œ */
        h2 {
            font-size: 1.1rem;
            border-left: 5px solid #3498db;
            padding-left: 10px;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* è¼¸å…¥å€ */
        .input-group {
            margin-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.95rem;
            color: #555;
        }
        input.sub-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1.1rem;
            box-sizing: border-box;
        }

        /* æŒ‰éˆ• */
        button.action-btn {
            width: 100%;
            padding: 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.2s;
        }
        button.action-btn:active {
            background-color: #2980b9;
        }

        /* çµæœé¢æ¿ */
        .result-panel {
            background: #eef7ff;
            border: 1px solid #b3d7ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }
        .big-number {
            font-size: 2.2rem;
            font-weight: 800;
            color: #e74c3c;
            display: block;
            margin: 5px 0;
        }

        /* æ»‘æ¡¿å€ */
        .slider-wrapper {
            background: #fafafa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            text-align: center;
        }
        .speed-display {
            font-size: 1.8rem;
            font-weight: 800;
            color: #2c3e50;
        }
        .base-ref {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 10px;
        }
        input[type="range"] {
            width: 100%;
            margin: 15px 0;
            cursor: pointer;
            height: 8px;
        }

        /* è¡¨æ ¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
        }
        th, td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        th {
            background-color: #f8f9fa;
            color: #666;
            font-size: 0.85rem;
        }
        .val-col {
            text-align: right;
            font-weight: bold;
            font-family: monospace;
            font-size: 1.1rem;
        }
        tr.highlight-row {
            background-color: #fff8e1;
        }
        tr.highlight-row td {
            color: #d35400;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="lang-bar">
        <button class="lang-btn active" onclick="setLang('tw')">ç¹é«”ä¸­æ–‡</button>
        <button class="lang-btn" onclick="setLang('jp')">æ—¥æœ¬èª</button>
        <button class="lang-btn" onclick="setLang('kr')">í•œêµ­ì–´</button>
        <button class="lang-btn" onclick="setLang('en')">English</button>
    </div>

    <h1 id="txt_title">éŸ³éŠ BPM è¨ˆç®—æ©Ÿ</h1>

    <div class="global-section">
        <label class="global-label" id="lbl_base">ğŸµ æ­¥é©Ÿ 1: è¼¸å…¥åŸå§‹æ­Œæ›² BPM</label>
        <input type="number" id="baseBpm" class="global-input" value="150" inputmode="numeric">
    </div>

    <h2 id="txt_h_target">A. ç›®æ¨™æ¨ç®—</h2>
    <div class="input-group">
        <label id="lbl_target">ç›®æ¨™ç·´ç¿’ BPM</label>
        <input type="number" id="targetBpm" class="sub-input" placeholder="ä¾‹å¦‚: 180" inputmode="numeric">
    </div>
    <button class="action-btn" id="btn_calc" onclick="calculateGoal()">è¨ˆç®—æœ€ä½³å€ç‡</button>

    <div class="result-panel" id="calcResult" style="display:none;">
        <div id="txt_suggest">å»ºè­°è¨­å®š Play Speed</div>
        <span class="big-number" id="suggestedSpeed">1.00</span>
        <div id="suggestedActual">å¯¦éš› BPM: -</div>
    </div>

    <div class="divider"></div>

    <h2 id="txt_h_sim">B. å¯†åº¦æ¨¡æ“¬èˆ‡æ›ç®—</h2>
    <div class="slider-wrapper">
        <label id="lbl_slider">æ‰‹å‹•èª¿æ•´ Speed</label>
        <div class="speed-display" id="currentSpeedDisplay">1.00</div>
        <div class="base-ref" id="txt_base_ref">(Base: 150)</div>
        
        <input type="range" id="speedSlider" min="0" max="16" step="1" value="6" oninput="updateDensityTable()">
        
        <div style="font-size:0.95rem; color:#555;">
            <span id="lbl_curr_actual">å¯¦éš› BPM</span>: 
            <span id="currentActualBpm" style="color:#2c3e50; font-weight:800; font-size:1.2rem;">150.0</span>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th id="th_type">éŸ³ç¬¦å¯†åº¦ (ä¸»é«”)</th>
                <th id="th_equiv" style="text-align:right;">ç­‰æ•ˆ 16åˆ†éŸ³</th>
            </tr>
        </thead>
        <tbody>
            <tr class="highlight-row">
                <td id="row_16">16åˆ†éŸ³ (æ¨™æº–)</td>
                <td class="val-col" id="val-16">150.0</td>
            </tr>
            <tr>
                <td id="row_8">8åˆ†éŸ³</td>
                <td class="val-col" id="val-8">75.0</td>
            </tr>
            <tr>
                <td id="row_12">12åˆ†éŸ³ (ä¸‰é€£éŸ³)</td>
                <td class="val-col" id="val-12">100.0</td>
            </tr>
            <tr>
                <td id="row_24">24åˆ†éŸ³ (å…­é€£éŸ³)</td>
                <td class="val-col" id="val-24">200.0</td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    // --- å¤šèªç³»è¨­å®š ---
    const i18n = {
        tw: {
            title: "INF BPM è¨ˆç®—æ©Ÿ",
            lbl_base: "ğŸµ æ­¥é©Ÿ 1: è¼¸å…¥åŸå§‹æ­Œæ›² BPM",
            h_target: "A. ç›®æ¨™æ¨ç®—",
            lbl_target: "ç›®æ¨™ç·´ç¿’ BPM",
            btn_calc: "è¨ˆç®—æœ€ä½³å€ç‡ (Play Speed)",
            txt_suggest: "å»ºè­°è¨­å®š Play Speed",
            txt_actual_res: "å¯¦éš› BPM: ",
            txt_error: "èª¤å·®",
            h_sim: "B. å¯†åº¦æ¨¡æ“¬èˆ‡æ›ç®—",
            lbl_slider: "æ‰‹å‹•èª¿æ•´ Play Speed",
            lbl_curr_actual: "å¯¦éš› BPM",
            th_type: "éŸ³ç¬¦å¯†åº¦",
            th_equiv: "ç­‰æ•ˆ 16åˆ†éŸ³ BPM",
            row_16: "16åˆ†éŸ³ (æ¨™æº–)",
            row_8: "8åˆ†éŸ³",
            row_12: "12åˆ†éŸ³ (ä¸‰é€£éŸ³)",
            row_24: "24åˆ†éŸ³ (å…­é€£éŸ³)",
            alert_msg: "è«‹å…ˆè¼¸å…¥ã€ŒåŸå§‹æ­Œæ›² BPMã€å’Œã€Œç›®æ¨™ BPMã€"
        },
        jp: {
            title: "INF BPMè¨ˆç®—æ©Ÿ",
            lbl_base: "ğŸµ æ‰‹é † 1: å…ƒã®BPMã‚’å…¥åŠ›",
            h_target: "A. ç›®æ¨™è¨ˆç®—",
            lbl_target: "ç›®æ¨™BPM (Target)",
            btn_calc: "æœ€é©å€ç‡ã‚’è¨ˆç®—",
            txt_suggest: "æ¨å¥¨ãƒ—ãƒ¬ã‚¤ã‚¹ãƒ”ãƒ¼ãƒ‰",
            txt_actual_res: "å®Ÿè³ªBPM: ",
            txt_error: "èª¤å·®",
            h_sim: "B. å¯†åº¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",
            lbl_slider: "å€ç‡èª¿æ•´ (Play Speed)",
            lbl_curr_actual: "å®Ÿè³ªBPM",
            th_type: "éŸ³ç¬¦å¯†åº¦",
            th_equiv: "16åˆ†éŸ³ç¬¦æ›ç®—",
            row_16: "16åˆ†éŸ³ç¬¦ (æ¨™æº–)",
            row_8: "8åˆ†éŸ³ç¬¦",
            row_12: "12åˆ†éŸ³ç¬¦ (3é€£ç¬¦)",
            row_24: "24åˆ†éŸ³ç¬¦ (6é€£ç¬¦)",
            alert_msg: "å…ƒã®BPMã¨ç›®æ¨™BPMã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
        },
        kr: {
            title: "INF BPM ê³„ì‚°ê¸°",
            lbl_base: "ğŸµ 1ë‹¨ê³„: ê¸°ë³¸ BPM ì…ë ¥",
            h_target: "A. ëª©í‘œ ê³„ì‚°",
            lbl_target: "ëª©í‘œ BPM (Target)",
            btn_calc: "ìµœì  ë°°ì† ê³„ì‚°",
            txt_suggest: "ì¶”ì²œ í”Œë ˆì´ ì†ë„",
            txt_actual_res: "ì‹¤ì œ BPM: ",
            txt_error: "ì˜¤ì°¨",
            h_sim: "B. ë°€ë„ ì‹œë®¬ë ˆì´ì…˜",
            lbl_slider: "í”Œë ˆì´ ì†ë„ ì¡°ì ˆ",
            lbl_curr_actual: "ì‹¤ì œ BPM",
            th_type: "ë…¸íŠ¸ ë°€ë„",
            th_equiv: "16ë¹„íŠ¸ í™˜ì‚° BPM",
            row_16: "16ë¹„íŠ¸ (í‘œì¤€)",
            row_8: "8ë¹„íŠ¸",
            row_12: "12ë¹„íŠ¸ (3ì—°ìŒ)",
            row_24: "24ë¹„íŠ¸ (6ì—°ìŒ)",
            alert_msg: "ê¸°ë³¸ BPMê³¼ ëª©í‘œ BPMì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
        },
        en: {
            title: "INF BPM Calc",
            lbl_base: "ğŸµ Step 1: Enter Base BPM",
            h_target: "A. Target Calculation",
            lbl_target: "Target BPM",
            btn_calc: "Calculate Best Speed",
            txt_suggest: "Best Play Speed",
            txt_actual_res: "Actual BPM: ",
            txt_error: "Error",
            h_sim: "B. Density Simulation",
            lbl_slider: "Adjust Play Speed",
            lbl_curr_actual: "Actual BPM",
            th_type: "Note Density",
            th_equiv: "Equiv. 16th BPM",
            row_16: "16th Note (Standard)",
            row_8: "8th Note",
            row_12: "12th Note (Triplets)",
            row_24: "24th Note (Sextuplets)",
            alert_msg: "Please enter Base BPM and Target BPM"
        }
    };

    let currentLang = 'tw';

    // 0.70 ~ 1.50
    const speeds = [];
    for(let i=70; i<=150; i+=5) {
        speeds.push(i/100);
    }

    // DOM Elements
    const baseBpmInput = document.getElementById('baseBpm');
    const targetBpmInput = document.getElementById('targetBpm');
    const slider = document.getElementById('speedSlider');
    const displaySpeed = document.getElementById('currentSpeedDisplay');
    const displayActual = document.getElementById('currentActualBpm');
    const baseRefText = document.getElementById('txt_base_ref');

    // åˆå§‹åŒ–
    window.onload = function() {
        setLang('tw');
        updateDensityTable();
    };

    // ç›£è½ï¼šåªè¦å‹•äº† Top çš„ Base BPMï¼Œä¸‹é¢å…¨éƒ¨é€£å‹•æ›´æ–°
    baseBpmInput.addEventListener('input', function() {
        // å¦‚æœä¸‹æ–¹è¨ˆç®—çµæœæ˜¯é–‹è‘—çš„ï¼Œå°±è‡ªå‹•é‡ç®—
        if(document.getElementById('calcResult').style.display !== 'none') {
            calculateGoal(false); // false: ä¸ç§»å‹•æ»‘æ¡¿ï¼Œåªæ›´æ–°æ•¸å­—
        }
        updateDensityTable(); // æ›´æ–°å¯†åº¦è¡¨
    });

    // èªè¨€åˆ‡æ›
    function setLang(lang) {
        currentLang = lang;
        const t = i18n[lang];

        // æŒ‰éˆ•æ¨£å¼
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
        const btnIdx = {'tw':0, 'jp':1, 'kr':2, 'en':3};
        document.querySelectorAll('.lang-btn')[btnIdx[lang]].classList.add('active');

        // æ–‡å­—æ›¿æ›
        document.getElementById('txt_title').textContent = t.title;
        document.getElementById('lbl_base').textContent = t.lbl_base;
        document.getElementById('txt_h_target').textContent = t.h_target;
        document.getElementById('lbl_target').textContent = t.lbl_target;
        document.getElementById('btn_calc').textContent = t.btn_calc;
        document.getElementById('txt_suggest').textContent = t.txt_suggest;
        document.getElementById('txt_h_sim').textContent = t.h_sim;
        document.getElementById('lbl_slider').textContent = t.lbl_slider;
        document.getElementById('lbl_curr_actual').textContent = t.lbl_curr_actual;
        document.getElementById('th_type').textContent = t.th_type;
        document.getElementById('th_equiv').textContent = t.th_equiv;
        
        document.getElementById('row_16').textContent = t.row_16;
        document.getElementById('row_8').textContent = t.row_8;
        document.getElementById('row_12').textContent = t.row_12;
        document.getElementById('row_24').textContent = t.row_24;

        // è‹¥å·²æœ‰è¨ˆç®—çµæœï¼Œé‡æ–°æ¸²æŸ“æ–‡å­—
        if(document.getElementById('calcResult').style.display !== 'none') {
             calculateGoal(false);
        }
    }

    // è¨ˆç®—åŠŸèƒ½
    function calculateGoal(moveSlider = true) {
        const base = parseFloat(baseBpmInput.value);
        const target = parseFloat(targetBpmInput.value);
        const t = i18n[currentLang];

        if (!base || !target) {
            if(moveSlider) alert(t.alert_msg);
            return;
        }

        const ratio = target / base;
        
        let bestDiff = 999;
        let bestIndex = 6;
        
        for(let i=0; i<speeds.length; i++) {
            let diff = Math.abs(speeds[i] - ratio);
            if(diff < bestDiff) {
                bestDiff = diff;
                bestIndex = i;
            }
        }

        const bestSpeed = speeds[bestIndex];
        const actual = base * bestSpeed;
        const diffVal = actual - target;

        const resultPanel = document.getElementById('calcResult');
        resultPanel.style.display = 'block';
        document.getElementById('suggestedSpeed').textContent = bestSpeed.toFixed(2);
        
        document.getElementById('suggestedActual').textContent = 
            `${t.txt_actual_res}${actual.toFixed(1)} (${t.txt_error} ${diffVal > 0 ? '+' : ''}${diffVal.toFixed(1)})`;

        if(moveSlider) {
            slider.value = bestIndex;
            updateDensityTable();
        }
    }

    // æ¨¡æ“¬è¡¨æ›´æ–°åŠŸèƒ½
    function updateDensityTable() {
        const idx = parseInt(slider.value);
        const currentSpeed = speeds[idx];
        
        displaySpeed.textContent = currentSpeed.toFixed(2);

        const base = parseFloat(baseBpmInput.value);
        
        // æ›´æ–°å°æç¤ºæ–‡å­—
        if(base) {
            baseRefText.textContent = `(Base: ${base})`;
        } else {
            baseRefText.textContent = "(Base: -)";
        }

        if(!base) {
            displayActual.textContent = "-";
            ['val-16','val-8','val-12','val-24'].forEach(id => document.getElementById(id).textContent = "-");
            return;
        }

        const actualBpm = base * currentSpeed;
        displayActual.textContent = actualBpm.toFixed(1);

        document.getElementById('val-16').textContent = (actualBpm * 1.0).toFixed(1);
        document.getElementById('val-8').textContent  = (actualBpm * 0.5).toFixed(1);
        document.getElementById('val-12').textContent = (actualBpm * (2/3)).toFixed(1);
        document.getElementById('val-24').textContent = (actualBpm * (4/3)).toFixed(1);
    }
</script>

</body>
</html>